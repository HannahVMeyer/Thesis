\section{Dataset and imputation}
The dataset generated by \citet{Bloom2013} consists of phenotype and genotype data of \num{1008} prototrophic haploid \emph{Saccharomyces cerevisiae} segregants derived from a cross between a laboratory strain (BY MATa) and a wine strain strain (RM MAT\(\alpha\)). In brief, the segregants were generated by mating of the haploid parental strains and subsequent sporulation of the diploid heterozygote. Sporulation resulted in  \num{1008} four-spore tetrads that showed 2:2 segregation of mating type and drug-resistance markers. From each tetrad one spore was selected for further analyses (\cref{fig:yeast-setup}).

\begin{figure}[p]
	\centering
	\includegraphics[trim = 0mm 0mm 0mm 0mm, clip, width=0.5\textwidth]{Chapter3/Figures/yeast-setup.pdf}
	\caption[\textbf{Generation of yeast dataset.}]{\textbf{Generation of yeast dataset. } Haploid parental strains BY MATa andRM MAT\(\alpha\)  were mated to generate diploid heterozygotes. These diploid heterozygotes were sporulated, during which they undergo meiosis and yield tetrads of recombinant haploids. From each tetrad, one spore was selected. For phenotyping, these segregants were grown an agar plates in different conditions. Adapted from \citep{Bloom2013}.}
 	\label{fig:yeast-setup}
\end{figure}


For phenotyping, these segregants were grown on agar plates in \num{46} growth conditions. These can broadly be grouped into growth on different carbohydrates or derivatives thereof (lactose, lactate, raffinose, maltose, mannose, sorbitol, trehalose, xylose, galactose), growth on different culture media (YPD, YNB) with different pH (YNB:pH3, YNB:pH8) or in different temperatures (YPD:4C, YPD:15C, YPD:37C), growth on different antibiotics and xenotbiotics (e.g. cadmium chloride, neomycin, zeocin, cis platin). For a full list, see labels in \cref{fig:traitcorrelations}. After incubation for 48h, the colony size of each segregant grown in the different conditions was measured. The final phenotypes were defined as the colony size normalised to colony size growth on control medium. For the remainder of this chapter, a trait is defined as this normalised growth size in one condition. Out of the \num{1008} segregants, \num{303} segregants were phenotyped for all \num{46} traits.

Segregants were genotyped using Illumina short-read sequencing. After mapping, quality control and filtering for unique genotype markers,  all \num{1008} segregants were genotyped \num{11623} unique genotypic markers. 

\subsection{Missing data mechanism} 
In order to gain an understanding of the dataset, I first looked at the frequencies and distribution of missing values. There are \num{135} different combinations of missing values across the samples and the missing phenotypes are not evenly distributed (\cref{fig:missingness}\subfig{A}). Some traits such as cobalt chloride are present for almost all samples while others such as sorbitol or raffinose are missing in more than a third of the samples. I used Little's global test for \gls{mcar} to analyse whether these observed data patterns can be accounted for by a \gls{mcar} mechanism. Little's method tests the null hypothesis that the data is \gls{mcar} \citep{Little1988,Beaujean2015}, which can in this case be rejected with a p-value of \num{2e-34} (based on a \(\chi^2\) distribution, \(\chi^2=\)\num{5902}, \(df=\)\num{4631}). 

\begin{figure}[p]
	\centering
	\includegraphics[trim = 0mm 0mm 0mm 0mm, clip, scale=0.85]{Chapter3/Figures/frequency-patterns.pdf}
	\caption[\textbf{Frequencies and distributions of missing values in the yeast phenotype data.}]{\textbf{Frequencies and distributions of missing values in the yeast phenotype data. }In both panels, the aggregation plot (middle) depicts all existing combinations of missing (blue) and non-missing (orange) values in the traits. The bar chart on its right shows the frequencies of occurrence of the different combinations. The histogram on the top shows the frequency of missing values for each trait (R Package: \emph{VIM} \citep{Templ2012}). A. The full dataset contains normalised colony sizes for growth in \num{46} different conditions of \num{1008} genotyped yeast segregants. \num{306} segregants are fully genotyped (bar chart, orange bar). B. Fully-phenotyped dataset of \num{306} segregants with simulated missing values based on the observed missingness pattern for the entire pool of \num{1008} segregants.  Generated via R function \textit{VIM::aggr}.}
 	\label{fig:missingness}
\end{figure}

Determining if data is \gls{mar} or \gls{mnar} cannot be tested for formally and relies on approximate measures and assumptions based on the experimental procedures \citep{Schafer2002,Garson2015,Templ2012}. \citet{Garson2015} suggests to use significance tests of missingness. If it can be demonstrated that one or more variables in the dataset are significantly correlated with missing values, missingness may be predictable, which is the requirement for imputing \gls{mar} data. In order to test for predictable missingness, I created an indicator matrix for the phenotype matrix, where observed values were encoded as zero and missing values as one. For each of the \num{46} traits in the dataset, I correlated the observed values across all samples with each column of the indicator matrix, i.e. the missingness patterns per trait. If all values were observed for a given trait, all values in the indicator matrix in this column were equal to zero and the correlation between the trait and the missingness was set to NA. \Cref{fig:missingnesscorrelations} shows the correlation patterns between the phenotypes and the missing values per trait. For traits like cobalt chloride and magnesium sulfate, where little data is missing, many entries are NA. Overall, for a number of traits and missingness patterns, there is sufficient evidence for predictable missingness and \gls{mar} assumptions for further analyses were considered valid. Most importantly, for data with \gls{mar}, the missing data mechanism is ignorable for maximum likelihood based methods and no further adjustments for the mechanisms have to be made in the modelling \citep{Rubin1976,Little1988}. Thus, the \gls{mar} assumption of missingness in the yeast data allows for imputation via the likelihood-based method of multiple imputation and \glspl{lmm}.


\begin{figure}[hbtp]
	\centering
	\includegraphics[trim = 0mm 0mm 0mm 0mm, clip, width=0.9\textwidth]{Chapter3/Figures/correlation_missingness.pdf}
	\caption[\textbf{Correlations of observed phenotypes with missing data values.}]{\textbf{Correlations of observed phenotypes with missing data values}. For each of the \num{46} traits, the Spearman's rank correlation coefficient \(\rho\) was computed with each column of the indicator matrix of the phenotypes, containing zero for observed values and one for missing values. The strength and the direction of correlations are depicted above, with the original phenotypes in rows and the indicator matrix of the phenotypes across columns.  Grey squares indicate NA, i.e. columns in the indicator matrix for which no traits were missing when correlated with the observed values for a given trait. Generated via R function \textit{corrplot::corrplot}.}
 	\label{fig:missingnesscorrelations}
\end{figure}

\subsection{Imputation via MICE} 
Imputation of missing values requires an understanding of which missing trait values can be reliably imputed and to find the best parameter settings for the imputation. In order to do this, I needed a fully phenotyped dataset with the same structure as the yeast dataset, where missing values could be introduced, imputed and subsequently compared to the true values. I chose a simple approach using the subset of the \num{303} fully phenotyped samples and introducing missing values with a similar pattern of missingness as observed in the original dataset. The results for the real (\cref{fig:missingness}\subfig{A}) and simulated (\cref{fig:missingness}\subfig{B}) dataset are similar in terms of frequencies and combinations of missing/non-missing traits. I used this simulated dataset as input to the imputation framework based on \gls{mice} \citep{vanBuuren2011}. 

\gls{mice} belongs to the general class of multiple imputation frameworks, where several imputed versions of the dataset are generated and each variable is imputed separately. The imputed values are chosen from plausible values drawn from a distribution that is specific for each variable, in this case for each trait. This distribution is derived from the dataset \(\mat{X} \in R^{N,P}\) itself,  with \(X\) split into missing and observed parts \(\mat{X} = (\mat{X}_\text{miss}, \mat{X}_\text{obs})\), the binary indicator matrix for missingness \(\mat{M} \in R^{N,P}\) and a set of predictor variables \(Z\). The \gls{mice} algorithm is usually divided into four steps \citep{Rubin1987,vanBuuren1999,Pigott2001}:
\begin{enumerate}
\item Specify the posterior predictive density \(p(\mat{X}_\text{miss} | Z, \mat{M})\) given the non-response mechanism  \(p(\mat{M} | \mat{X})\)  and the complete data model  \(p(\mat{X})\).
\item Draw imputations from this density to produce \(m\) complete data sets. 
\item Perform \(m\) complete-data analyses on each completed data matrix. 
\item Pool the \(m\) analysis results into final point and variance estimates.
\end{enumerate}
\citet{Garson2015} approach allows me to  obtain reliable imputation estimates while having to estimate the variance components via \gls{limmbo} only once. As described in the previous chapter, \gls{limmbo} strongly reduces the computation time for the variance decomposition (\cref{section:scalability-limmbo}), but it is still the time consuming factor in the analysis. 

The two main choices when applying \gls{mice} for imputation have to be made in step one: the type of the imputation model and the choice of predictor variables. 

\paragraph{Imputation model.}From the different imputation models available (examples described in \citep{vanBuuren2011}), I found predictive mean matching, a semi-parametric method which preserves non-linear relations in the data \citep{Little1988,vanBuuren2011}, a fast and sensible imputation option.  In brief, predictive mean matching finds the mean and covariance of the multivariate distribution \(\mat{X}\) with missing values (often simply based on the complete cases). Subsequently, for each incomplete sample it predicts the missing values \(\mat{X}_\text{miss}\) based on \(\mat{X}_\text{obs}\) and the provided predictor variables \(Z\). In addition, values of the complete samples for the same set of \(\mat{X}_\text{miss}\) are predicted. The predicted values of the incomplete sample are than matched to the predicted values of the complete samples and the closest match is chosen. The imputed values for the incomplete sample are set to the observed values of the closest match \citep{Little1988}. In this way, only realistic and theoretically observable values (assuming proper quality control of the data prior to imputation) are imputed.

\paragraph{Predictor variables.} \citet{Collins2001} show that as many valid predictor variables as possible should be included in the imputation to obtain the least amount of bias and maximal certainty about the predictions. In addition,  \citet{Schafer1997} demonstrated that using this strategy makes \gls{mar} assumptions more plausible. However, not all predictors will be relevant and the choice of predictors can be done on a per-variable level. In order to select suitable predictors for each trait, I first computed the pairwise Spearman correlation coefficient \(\rho\) for all traits across the \num{303} fully-phenotyped segregants. Some of the traits like cadmium chloride or neomycin show very little correlation to any of the other traits, while many of the traits based on growth on different carbohydrate resources form a large cluster of moderate to strong correlation (\cref{fig:traitcorrelations}). 
I tested several sets of predictor variables, either using all traits as predictors or choosing predictors based on the pairwise \(\rho\) of the traits. For each trait, I included predictors that showed a correlation higher than a predefined threshold (\(\rho =\left\{0.1, 0.2, 0.3\right\}\)). In addition, I restricted the predictors to traits that had been measured in at least 20\% of the samples in the dataset. This excluded cadmium chloride  (21\% missing), hydrogen peroxide (24\%), raffinose (34\%), sorbitol (41\%) and YPD:4C (20\%) as predictor variables, but did not prevent them from being imputed.

\begin{figure}[hbtp]
	\centering
	\includegraphics[trim = 0mm 0mm 0mm 0mm, clip, width=0.9\textwidth]{Chapter3/Figures/correlation_pheno_noNA.pdf}
	\caption[\textbf{Pairwise correlations of \num{46} growth traits in \emph{Saccharomyces cerevisiae}.}]{\textbf{Pair-wise correlations of \num{46} growth traits in \emph{Saccharomyces cerevisiae}.} For each trait pair, Pearson's correlation coefficient \(\rho\) and the p-values of the correlation were computed. The p-values were adjusted for multiple testing according to Benjamini and Hochberg's method \citep{Benjamini1995}. The strength and the direction of significant correlations (\(FDR < 0.05\)) are depicted above. Non-significant correlations are left blank. The traits are clustered based on complete-linkage clustering of \((1-\rho)\) as distance measurement and the largest clusters are indicated by black squares. Generated via R function \textit{corrplot::corrplot}.}
 	\label{fig:traitcorrelations}
\end{figure}


Further parameters for \gls{mice} are the number of imputed datasets \(m\) (set to \(m=20\)) and the number of iterations \(maxit\) (set to \(maxit=30\)). For each predictor set-up, I initiated \gls{mice} with the same seed for the random number generator to ensure comparability. After imputation, I evaluated the goodness of the imputation  by computing the Spearman correlation of the imputed values (averaged across iterations \(m\)) to the experimentally observed ones (\cref{fig:mice}). Traits where the imputed values correlated to the original ones by more then \num{95}\% in at least one of the predictor set-ups were retained in the analysis. For five traits (cadmium chloride, hydrogen peroxide, raffinose, YNB:ph8, YPD:4C), no suitable predictors could be determined and these were excluded from further analyses (\cref{fig:mice}, red labels). For each trait, I chose the predictor scheme that yielded the highest correlation between the imputed and observed data for the imputation of the missing values in the full dataset. Missing values were imputed in segregants that were phenotyped for at least \num{80}\% of the traits. The final dataset contained \num{981} segregants with phenotypes for \num{41} traits each. 
 	
\begin{figure}[hbtp]
	\centering
	\includegraphics[trim = 0mm 0mm 0mm 0mm, clip, width=01\textwidth]{Chapter3/Figures/imputation_correlation_median_imputationvalue.pdf}
	\caption[\textbf{Correlation between imputed and experimentally observed trait values.}]{\textbf{Correlation between imputed and experimentally observed trait values.} In the subset of \num{306} fully phenotyped samples, missing values were introduced and subsequently imputed via \gls{mice}. Different predictor sets were tested based on Pearson's correlation coefficient: traits were considered predictors if their correlation with the target trait was greater than a given threshold. For each predictor setup (all traits as predictors and predictors passing the correlation threshold \(\rho =\left\{0.1, 0.2, 0.3\right\}\)), \(m=20\) imputed datasets and \(maxit=30\) iterations of \gls{mice} were conducted. The goodness of the imputation was evaluated by computing the correlation of the imputed values (averaged across iterations \(m\)) to the experimentally observed ones. Traits with at least one correlation greater than the \num{0.95} threshold (black vertical line) were retained in the dataset. For traits labelled in red, the imputation was considered to be unreliable and the traits were excluded from further analyses.}
 	\label{fig:mice}
\end{figure}


